<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<body>

<div th:fragment="box(notifications, nonLuesCount)">

  <div class="panel">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-bell"></i> Notifications
      </h5>

      <span class="badge bg-danger" id="notifCount"
            th:if="${nonLuesCount != null and nonLuesCount > 0}"
            th:text="${nonLuesCount} + ' non lue(s)'">
        0
      </span>

      <span class="badge bg-secondary" id="notifCount"
            th:if="${nonLuesCount == null or nonLuesCount == 0}">
        Aucune
      </span>
    </div>

    <!-- Liste notifications -->
    <div class="mt-3" id="notifListWrap"
         th:if="${notifications != null and !#lists.isEmpty(notifications)}">
      <ul class="list-group" id="notifList">
        <li class="list-group-item d-flex justify-content-between align-items-start"
            th:each="n : ${notifications}"
            th:classappend="${n.lu} ? '' : ' list-group-item-warning'">

          <div class="me-3">
            <div class="fw-semibold">
              <span class="badge bg-info text-dark me-2"
                    th:text="${n.type}">TYPE</span>
              <span th:text="${n.message}">Message</span>
            </div>
            <small class="text-muted" th:text="${n.dateEnvoi}">date</small>
          </div>

          <form th:if="${!n.lu}"
                th:action="@{'/notifications/lue/' + ${n.id}}"
                method="post">
            <button class="btn btn-sm btn-outline-primary" type="submit">
              Marquer lue
            </button>
          </form>

          <span th:if="${n.lu}" class="badge bg-success">Lue</span>
        </li>
      </ul>
    </div>

    <!-- Aucun message -->
    <div class="alert alert-info mt-3 mb-0" id="notifEmpty"
         th:if="${notifications == null or #lists.isEmpty(notifications)}">
      <i class="bi bi-info-circle"></i> Aucune notification pour le moment.
    </div>

    <!-- Test email simple (optionnel : garde ou supprime) -->
    <hr class="my-3"/>
    <form th:action="@{/notifications/test-email}" method="post" class="d-flex gap-2">
      <input class="form-control"
             name="message"
             placeholder="Message test email..."
             required />
      <button class="btn btn-primary" type="submit">
        <i class="bi bi-send"></i> Tester email
      </button>
    </form>

  </div>

</div>

</body>
</html>
