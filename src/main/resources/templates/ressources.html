<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resources Management</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --primary-color: #4a90e2;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
      }

      body {
        background: #f5f7fa;
        min-height: 100vh;
        padding: 2rem 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 1rem;
      }

      .header-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .header-section h1 {
        color: #333;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .header-section h1 i {
        color: var(--primary-color);
      }

      .add-btn {
        background: linear-gradient(135deg, #667eea 0%, #3799e9 100%);
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        transition: transform 0.3s, box-shadow 0.3s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .add-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        color: white;
      }

      .resource-card {
        background: white;
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .resource-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
      }

      .resource-cover {
        width: 100%;
        height: 300px;
        object-fit: cover;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 5rem;
        color: #667eea;
      }

      .resource-cover img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .resource-body {
        padding: 1.5rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      .resource-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 0.5rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .resource-author {
        color: #6c757d;
        font-size: 0.95rem;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .resource-type {
        display: inline-block;
        padding: 0.35rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .type-LIVRE {
        background: #e3f2fd;
        color: #1976d2;
      }
      .type-DOCUMENT {
        background: #f3e5f5;
        color: #7b1fa2;
      }
      .type-CD {
        background: #fff3e0;
        color: #f57c00;
      }
      .type-DVD {
        background: #fce4ec;
        color: #c2185b;
      }
      .type-REVUE {
        background: #e8f5e9;
        color: #388e3c;
      }

      .resource-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: auto;
      }

      .action-btn {
        flex: 1;
        padding: 0.5rem;
        border: none;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 600;
        transition: all 0.3s;
        text-decoration: none;
        text-align: center;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.3rem;
      }

      .btn-edit {
        background: #4a90e2;
        color: white;
      }

      .btn-edit:hover {
        background: #357abd;
        color: white;
        transform: scale(1.05);
      }

      .btn-delete {
        background: #dc3545;
        color: white;
      }

      .btn-delete:hover {
        background: #c82333;
        color: white;
        transform: scale(1.05);
      }

      .btn-exemplaires {
        background: #28a745;
        color: white;
      }

      .btn-exemplaires:hover {
        background: #218838;
        color: white;
        transform: scale(1.05);
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .empty-state i {
        font-size: 5rem;
        color: #ccc;
        margin-bottom: 1rem;
      }

      .empty-state h3 {
        color: #666;
        margin-bottom: 1rem;
      }

      @media (max-width: 768px) {
        .resource-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <!-- FILTRES (UI améliorée, mais classes métier inchangées) -->
      <form class="row g-3 mb-4" th:action="@{/ressources}" method="get">
        <div class="col-12">
          <div class="p-3 p-lg-4 border rounded-3 bg-light">
            <div class="row g-3 align-items-end">
              <div class="col-12 col-lg-4">
                <label class="form-label small text-muted mb-1"
                  >Recherche</label
                >
                <div class="input-group">
                  <span class="input-group-text"
                    ><i class="bi bi-search"></i
                  ></span>
                  <input
                    class="form-control"
                    name="q"
                    type="text"
                    placeholder="Title, author, description..."
                    th:value="${q}"
                  />
                </div>
              </div>

              <div class="col-12 col-lg-3">
                <label class="form-label small text-muted mb-1"
                  >Category</label
                >
                <input
                  class="form-control"
                  name="categorie"
                  type="text"
                  placeholder="Category"
                  th:value="${categorie}"
                />
              </div>

              <div class="col-12 col-sm-6 col-lg-2">
                <label class="form-label small text-muted mb-1">Type</label>
                <select class="form-select" name="type">
                  <option value="" th:selected="${type == null}">
                    All types
                  </option>
                  <option
                    th:each="t : ${types}"
                    th:value="${t}"
                    th:text="${t}"
                    th:selected="${type != null and t == type}"
                  ></option>
                </select>
              </div>

              <div class="col-6 col-sm-6 col-lg-2">
                <label class="form-label small text-muted mb-1">Date du</label>
                <input
                  class="form-control"
                  name="dateFrom"
                  type="date"
                  th:value="${dateFrom != null ? #temporals.format(dateFrom, 'yyyy-MM-dd') : ''}"
                />
              </div>

              <div class="col-6 col-sm-6 col-lg-2">
                <label class="form-label small text-muted mb-1">Date au</label>
                <input
                  class="form-control"
                  name="dateTo"
                  type="date"
                  th:value="${dateTo != null ? #temporals.format(dateTo, 'yyyy-MM-dd') : ''}"
                />
              </div>

              <div class="col-12 col-sm-6 col-lg-2">
                <label class="form-label small text-muted mb-1"
                  >Trier par</label
                >
                <select class="form-select" name="sort">
                  <option
                    value="publishDate"
                    th:selected="${sort == 'publishDate'}"
                  >
                    Date
                  </option>
                  <option value="titre" th:selected="${sort == 'titre'}">
                    Title
                  </option>
                  <option value="auteur" th:selected="${sort == 'auteur'}">
                    Author
                  </option>
                  <option
                    value="categorie"
                    th:selected="${sort == 'categorie'}"
                  >
                    Category
                  </option>
                  <option
                    value="typeRessource"
                    th:selected="${sort == 'typeRessource'}"
                  >
                    Type
                  </option>
                </select>
              </div>

              <div class="col-6 col-sm-6 col-lg-2">
                <label class="form-label small text-muted mb-1">Order</label>
                <select class="form-select" name="dir">
                  <option value="desc" th:selected="${dir == 'desc'}">
                    Desc
                  </option>
                  <option value="asc" th:selected="${dir == 'asc'}">Asc</option>
                </select>
              </div>

              <div class="col-6 col-sm-6 col-lg-2">
                <label class="form-label small text-muted mb-1">Per page</label>
                <select class="form-select" name="size">
                  <option value="8" th:selected="${size == 8}">8</option>
                  <option value="12" th:selected="${size == 12}">12</option>
                  <option value="24" th:selected="${size == 24}">24</option>
                  <option value="48" th:selected="${size == 48}">48</option>
                </select>
              </div>

              <div class="col-12 col-lg-2 d-grid">
                <button class="btn btn-primary" type="submit">
                  <i class="bi bi-funnel"></i> Filter
                </button>
              </div>

              <div class="col-12 col-lg-2 d-grid">
                <a class="btn btn-outline-secondary" th:href="@{/ressources}">
                  Reset
                </a>
              </div>

              <div class="col-12">
                <div
                  class="d-flex justify-content-between flex-wrap gap-2 small text-muted"
                >
                  <span th:if="${page != null}">
                    Page <span th:text="${page.number + 1}">1</span> /
                    <span th:text="${page.totalPages}">1</span>
                    — Total: <span th:text="${page.totalElements}">0</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>

      <div class="main-container">
        <div class="header-section">
          <div
            class="d-flex justify-content-between align-items-center flex-wrap gap-3"
          >
            <h1>
              <i class="bi bi-collection"></i>
              Resource Library
            </h1>
            <a
              href="/ressources/add"
              class="add-btn"
              sec:authorize="hasAnyRole('ADMIN','BIBLIOTHECAIRE')"
            >
              <i class="bi bi-plus-circle"></i>
              Add a resource
            </a>
          </div>
        </div>

        <!-- LISTE -->
        <div class="row g-4" th:if="${page != null and page.totalElements > 0}">
          <div
            class="col-12 col-sm-6 col-md-4 col-lg-3"
            th:each="r : ${page.content}"
          >
            <div class="resource-card">
              <div class="resource-cover">
                <img
                  th:if="${r.coverPath != null}"
                  th:src="@{/ressources/cover/{id}(id=${r.id})}"
                  th:alt="${r.titre}"
                />
                <i
                  th:unless="${r.coverPath != null}"
                  th:class="${r.typeRessource == 'LIVRE' ? 'bi bi-book' :
                              r.typeRessource == 'DOCUMENT' ? 'bi bi-file-text' :
                              r.typeRessource == 'CD' ? 'bi bi-disc' :
                              r.typeRessource == 'DVD' ? 'bi bi-camera-reels' :
                              'bi bi-journal'}"
                ></i>
              </div>

              <div class="resource-body">
                <h3 class="resource-title" th:text="${r.titre}">Title</h3>

                <div class="resource-author">
                  <i class="bi bi-person"></i>
                  <span th:text="${r.auteur}">Author</span>
                </div>

                <span
                  class="resource-type"
                  th:classappend="'type-' + r.typeRessource"
                  th:text="${r.typeRessource}"
                ></span>

                <div class="resource-author">
                  <i class="bi bi-calendar-event"></i>
                  <span
                    th:text="${r.publishDate != null ? #temporals.format(r.publishDate, 'dd/MM/yyyy') : 'Unknown date'}"
                  >
                    01/01/2024
                  </span>
                </div>

                <div
                  class="resource-actions"
                  sec:authorize="hasAnyRole('ADMIN','BIBLIOTHECAIRE')"
                >
                  <a
                    th:href="@{'/ressources/edit/' + ${r.id}}"
                    class="action-btn btn-edit"
                  >
                    <i class="bi bi-pencil"></i>
                    Edit
                  </a>
                  <a
                    th:href="@{'/ressources/delete/' + ${r.id}}"
                    class="action-btn btn-delete"
                    onclick="return confirm('Are you sure you want to delete this resource?');"
                  >
                    <i class="bi bi-trash"></i>
                    Delete
                  </a>
                </div>

                <div
                  class="resource-actions mt-2"
                  sec:authorize="hasAnyRole('ADMIN','BIBLIOTHECAIRE')"
                >
                  <a
                    th:href="@{'/exemplaires/add/' + ${r.id}}"
                    class="action-btn btn-exemplaires"
                  >
                    <i class="bi bi-stack"></i>
                    Add Physical copy
                  </a>
                </div>

                <div class="resource-actions mt-2">
                  <a
                    th:href="@{'/exemplaires/ressource/' + ${r.id}}"
                    class="action-btn btn-exemplaires"
                  >
                    <i class="bi bi-stack"></i>
                    View copies / Reserve
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- EMPTY -->
        <div
          class="empty-state"
          th:if="${page == null or page.totalElements == 0}"
        >
          <i class="bi bi-inbox"></i>
          <h3>No resources available</h3>
          <p class="text-muted">Start by adding your first resource</p>
          <a href="/ressources/add" class="add-btn mt-3">
            <i class="bi bi-plus-circle"></i>
            Add a resource
          </a>
        </div>
      </div>

      <!-- PAGINATION (liens robustes) -->
      <nav th:if="${page != null and page.totalPages > 1}" class="mt-4">
        <ul class="pagination justify-content-center flex-wrap">
          <li class="page-item" th:classappend="${page.first} ? 'disabled'">
            <a
              class="page-link"
              th:href="@{/ressources(
                page=${page.number - 1},
                size=${size},
                q=${q},
                categorie=${categorie},
                type=${type != null ? type.name() : ''},
                dateFrom=${dateFrom != null ? #temporals.format(dateFrom,'yyyy-MM-dd') : ''},
                dateTo=${dateTo != null ? #temporals.format(dateTo,'yyyy-MM-dd') : ''},
                sort=${sort},
                dir=${dir}
              )}"
              >Previous</a
            >
          </li>

          <li
            class="page-item"
            th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
            th:classappend="${i == page.number} ? 'active'"
          >
            <a
              class="page-link"
              th:text="${i + 1}"
              th:href="@{/ressources(
                page=${i},
                size=${size},
                q=${q},
                categorie=${categorie},
                type=${type != null ? type.name() : ''},
                dateFrom=${dateFrom != null ? #temporals.format(dateFrom,'yyyy-MM-dd') : ''},
                dateTo=${dateTo != null ? #temporals.format(dateTo,'yyyy-MM-dd') : ''},
                sort=${sort},
                dir=${dir}
              )}"
            ></a>
          </li>

          <li class="page-item" th:classappend="${page.last} ? 'disabled'">
            <a
              class="page-link"
              th:href="@{/ressources(
                page=${page.number + 1},
                size=${size},
                q=${q},
                categorie=${categorie},
                type=${type != null ? type.name() : ''},
                dateFrom=${dateFrom != null ? #temporals.format(dateFrom,'yyyy-MM-dd') : ''},
                dateTo=${dateTo != null ? #temporals.format(dateTo,'yyyy-MM-dd') : ''},
                sort=${sort},
                dir=${dir}
              )}"
              >Next</a
            >
          </li>
        </ul>
      </nav>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
